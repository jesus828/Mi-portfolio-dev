<div class="sb-wrap">
  <h2>¡Reserva Ahora!</h2>
  <p>El mejor precio, sólo en nuestro sitio oficial, garantizado.</p>

  <div class="sb-form">

    <div class="sb-field">
      <label>Llegada</label>
      <input type="date" id="sb-checkin">
    </div>

    <div class="sb-field">
      <label>Salida</label>
      <input type="date" id="sb-checkout">
    </div>

    <div class="sb-guests-wrap" id="sbGuestsWrap">
      <label>Huéspedes</label>
      <div class="sb-guests-display" id="sbGuestsDisplay">2 adultos · 0 niños</div>
      <div class="sb-dropdown" id="sbDropdown">
        <div class="sb-counter">
          <span class="sb-counter-label">Adultos</span>
          <div class="sb-counter-controls">
            <button id="sb-adults-minus">−</button>
            <span class="sbcount" id="sbAdults">2</span>
            <button id="sb-adults-plus">+</button>
          </div>
        </div>
        <div class="sb-counter">
          <span class="sb-counter-label">Niños</span>
          <div class="sb-counter-controls">
            <button id="sb-children-minus">−</button>
            <span class="sbcount" id="sbChildren">0</span>
            <button id="sb-children-plus">+</button>
          </div>
        </div>
      </div>
    </div>

    <div class="sb-promo">
      <label>Código Promocional</label>
      <input type="text" id="sbPromo" placeholder="Opcional">
    </div>

    <button class="sb-btn" id="sbVerTarifas">
      Ver Tarifas &#128269;
    </button>

  </div>
</div>

<script>
(function() {

  // ── CONFIGURACIÓN ─────────────────────────────────────
  var BASE_URL  = "https://www.simplebooking.it/ibe2/hotel/10870";
  var LANG      = "ES";
  var CUR       = "PEN";
  // ──────────────────────────────────────────────────────

  var adults   = 2;
  var children = 0;

  function updateDisplay() {
    var txt = adults + ' adulto' + (adults !== 1 ? 's' : '');
    txt += ' · ' + children + ' niño' + (children !== 1 ? 's' : '');
    document.getElementById('sbGuestsDisplay').textContent = txt;
    document.getElementById('sbAdults').textContent   = adults;
    document.getElementById('sbChildren').textContent = children;
  }

  // Botones contador
  document.getElementById('sb-adults-minus').addEventListener('click',   function(e){ e.stopPropagation(); adults   = Math.max(1, adults-1);   updateDisplay(); });
  document.getElementById('sb-adults-plus').addEventListener('click',    function(e){ e.stopPropagation(); adults++;                           updateDisplay(); });
  document.getElementById('sb-children-minus').addEventListener('click', function(e){ e.stopPropagation(); children = Math.max(0, children-1); updateDisplay(); });
  document.getElementById('sb-children-plus').addEventListener('click',  function(e){ e.stopPropagation(); children++;                         updateDisplay(); });

  // Toggle dropdown
  document.getElementById('sbGuestsWrap').addEventListener('click', function() {
    document.getElementById('sbDropdown').classList.toggle('open');
  });

  // Cerrar dropdown al click fuera
  document.addEventListener('click', function(e) {
    if (!document.getElementById('sbGuestsWrap').contains(e.target)) {
      document.getElementById('sbDropdown').classList.remove('open');
    }
  });

  // Fechas por defecto: hoy y mañana
  function fmt(d) {
    return d.getFullYear() + '-'
      + String(d.getMonth()+1).padStart(2,'0') + '-'
      + String(d.getDate()).padStart(2,'0');
  }
  var hoy    = new Date();
  var manana = new Date(hoy); manana.setDate(hoy.getDate()+1);
  document.getElementById('sb-checkin').value  = fmt(hoy);
  document.getElementById('sb-checkout').value = fmt(manana);
  document.getElementById('sb-checkin').min    = fmt(hoy);
  document.getElementById('sb-checkout').min   = fmt(manana);

  document.getElementById('sb-checkin').addEventListener('change', function() {
    var ci = new Date(this.value + 'T00:00:00');
    ci.setDate(ci.getDate()+1);
    var minOut = fmt(ci);
    document.getElementById('sb-checkout').min = minOut;
    if (document.getElementById('sb-checkout').value <= this.value)
      document.getElementById('sb-checkout').value = minOut;
  });

  // Botón Ver Tarifas
  document.getElementById('sbVerTarifas').addEventListener('click', function() {
    var checkin  = document.getElementById('sb-checkin').value;
    var checkout = document.getElementById('sb-checkout').value;
    var promo    = document.getElementById('sbPromo').value;

    if (!checkin || !checkout) {
      alert('Por favor selecciona las fechas de llegada y salida.');
      return;
    }
    if (checkin >= checkout) {
      alert('La fecha de salida debe ser posterior a la llegada.');
      return;
    }

    // Construir guests: A por adulto, C por niño
    var guests = [];
    for (var i = 0; i < adults; i++)   guests.push('A');
    for (var i = 0; i < children; i++) guests.push('C');

    var url = BASE_URL
      + '?lang='   + LANG
      + '&cur='    + CUR
      + '&guests=' + guests.join(',')
      + '&in='     + checkin
      + '&out='    + checkout
      + '&coupon=' + encodeURIComponent(promo);

    window.open(url, '_blank');
  });

})();
</script>
